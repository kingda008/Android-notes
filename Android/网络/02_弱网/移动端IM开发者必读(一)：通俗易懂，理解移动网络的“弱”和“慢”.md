## 1、前言


随着移动互联网的高速发展，移动端IM以移动网络作为物理通信载体早已深入人心，这其中的成功者就包括微信、手机QQ、支付宝（从即时通讯产品的角度来看，支付宝已经算的上是半个IM了）等等，也为移动端即时通讯开发者带来了各种可以参考的标杆功能和理念：语音对讲、具有移动端体验特性的图片消息、全时在线的概念、真正突破物理体验的实时通知等。

上述IM产品、功能和概念，在开发者间讨论时，无一例外都会被打上“移动端”这个特性，从网络通信的角度来说，这个特性的本质可以认为就是移动网络的特性。

以文件发送为例，传统的PC端IM（可以简单地理解为传统有线网络上的IM）可以直接实时点对点发送（理论上无需经过服务器中转）。

**但在移动端IM里我们并不能这么干，原因是：**



- 1）3G/4G/5G网络下P2P成功率并没有那么高（因为是对称型NAT，详见《[通俗易懂：快速理解P2P技术中的NAT穿透原理](http://www.52im.net/thread-1055-1-1.html)》）；
- 2）移动网络的信号跳变、抖动很难预测（甚至在你转身的瞬间，信号可能会立马由强变弱）；
- 3）移动网络的延迟、丢包、重传等导致通信体验很差（就像从国内访问国外的网站那种“慢”，体验上是相似的）；
- 4）延迟、丢包、重传带来的另一个后果就是电量消耗、流量消耗过大，这些都是不可接受的；
- 5）智能手机（主要是Android、iOS）的系统省电策略，导致网络可能被阻断，甚至进程被杀死，功能没办法在后台继续工作。


所以，正是移动网络的这些特性，使得原本在传统PC端再普通不过的功能（比如上面说的文件发送），在移动端IM中却不得不另想办法：以文件发送为例——主流的移动端IM现在都是使用服务器中转来搞定的。使用类似技术实现的功能，还有移动端IM里语音短消息的AMR音频小文件、图片消息的图片文件等。

**那么回归到本文的正题：**移动网络为什么会存在“弱”和“慢”这样的特性？

这个问题网络工程师来回答最为合适，对但于应用层的程序员来说，有关移动网络的理论太生涩枯燥，太难理解了。而对于网络工程师来说，他们也不理解“你们这些程序员到底在纠结移动网络的什么鬼？”。

就像黄品源的那首《那么爱你为什么》的歌曲里面莫文蔚的一段念白：“我讲又讲不清，你听又听不懂......”。这大概是应用层程序员很难能找到通俗易懂的有关移动网络资料的原因吧。

所以本文的目的，就是希望以通俗易懂的语言，帮助移动端IM开发者更好地理解移动网络的各种特性，使得开发出的功能能更好地适应移动网络，给用户带来更好的使用体验。

另外，《[现代移动端网络短连接的优化手段总结：请求速度、弱网适应、安全保障](http://www.52im.net/thread-1413-1-1.html)》这篇文章也提到了本文所阐述的相关内容，强烈建议阅读。

## 2、系列文章


**▼ 本文是《移动端IM开发者必读》系列文章的第1篇：**



- 《[移动端IM开发者必读(一)：通俗易懂，理解移动网络的“弱”和“慢”](http://www.52im.net/thread-1587-1-1.html)》（本文）
- 《[移动端IM开发者必读(二)：史上最全移动弱网络优化方法总结](http://www.52im.net/thread-1588-1-1.html)》


如果您是IM开发初学者，强烈建议首先阅读《[新手入门一篇就够：从零开发移动端IM](http://www.52im.net/thread-464-1-1.html)》。

## 3、相关文章


**1）关于网络通信的基础文章：**



- 如果您对网络通信知识了解甚少，建议阅读《[网络编程懒人入门系列文章](http://www.52im.net/thread-1095-1-1.html)》、《[脑残式网络编程入门系列](http://www.52im.net/thread-1729-1-1.html)》，更高深的网络通信文章可以阅读《[不为人知的网络编程系列文章](http://www.52im.net/thread-1003-1-1.html)》。


**2）涉及移动端网络特性的文章：**



- 《[现代移动端网络短连接的优化手段总结：请求速度、弱网适应、安全保障](http://www.52im.net/thread-1413-1-1.html)》
- 《[全面了解移动端DNS域名劫持等杂症：技术原理、问题根源、解决方案等](http://www.52im.net/thread-2121-1-1.html)》
- 《[美图App的移动端DNS优化实践：HTTPS请求耗时减小近半](http://www.52im.net/thread-2172-1-1.html)》
- 《[百度APP移动端网络深度优化实践分享(一)：DNS优化篇](http://www.52im.net/thread-2472-1-1.html)》
- 《[百度APP移动端网络深度优化实践分享(二)：网络连接优化篇](http://www.52im.net/thread-2479-1-1.html)》
- 《[百度APP移动端网络深度优化实践分享(三)：移动端弱网优化篇](http://www.52im.net/thread-2678-1-1.html)》
- 《[爱奇艺移动网络优化实践分享：网络请求成功率优化篇](http://www.52im.net/thread-2981-1-1.html)》
- 《[谈谈移动端 IM 开发中登录请求的优化](http://www.52im.net/thread-282-1-1.html)》
- 《[移动端IM开发需要面对的技术问题（含通信协议选择）](http://www.52im.net/thread-133-1-1.html)》
- 《[简述移动端IM开发的那些坑：架构设计、通信协议和客户端](http://www.52im.net/thread-289-1-1.html)》
- 《[微信对网络影响的技术试验及分析（论文全文）](http://www.52im.net/thread-195-1-1.html)》
- 《[腾讯原创分享(一)：如何大幅提升移动网络下手机QQ的图片传输速度和成功率](http://www.52im.net/thread-675-1-1.html)》
- 《[腾讯原创分享(二)：如何大幅压缩移动网络下APP的流量消耗（上篇）](http://www.52im.net/thread-696-1-1.html)》
- 《[腾讯原创分享(二)：如何大幅压缩移动网络下APP的流量消耗（下篇）](http://www.52im.net/thread-697-1-1.html)》
- 《[如约而至：微信自用的移动端IM网络层跨平台组件库Mars已正式开源](http://www.52im.net/thread-684-1-1.html)》


**3）如果您觉得有些网络问题，已无法从应用层找到答案，那么以下这个系列是你的“菜”：**
  以下文章为IM/推送技术开发的边界知识，但有助于你从物理层理解各种网络问题。如无兴趣，可忽略之！

- 《[IM开发者的零基础通信技术入门(一)：通信交换技术的百年发展史(上)](http://www.52im.net/thread-2354-1-1.html)》
- 《[IM开发者的零基础通信技术入门(二)：通信交换技术的百年发展史(下)](http://www.52im.net/thread-2356-1-1.html)》
- 《[IM开发者的零基础通信技术入门(三)：国人通信方式的百年变迁](http://www.52im.net/thread-2360-1-1.html)》
- 《[IM开发者的零基础通信技术入门(四)：手机的演进，史上最全移动终端发展史](http://www.52im.net/thread-2369-1-1.html)》
- 《[IM开发者的零基础通信技术入门(五)：1G到5G，30年移动通信技术演进史](http://www.52im.net/thread-2373-1-1.html)》
- 《[IM开发者的零基础通信技术入门(六)：移动终端的接头人——“基站”技术](http://www.52im.net/thread-2375-1-1.html)》
- 《[IM开发者的零基础通信技术入门(七)：移动终端的千里马——“电磁波”](http://www.52im.net/thread-2382-1-1.html)》
- 《[IM开发者的零基础通信技术入门(八)：零基础，史上最强“天线”原理扫盲](http://www.52im.net/thread-2385-1-1.html)》
- 《[IM开发者的零基础通信技术入门(九)：无线通信网络的中枢——“核心网”](http://www.52im.net/thread-2391-1-1.html)》
- 《[IM开发者的零基础通信技术入门(十)：零基础，史上最强5G技术扫盲](http://www.52im.net/thread-2394-1-1.html)》
- 《[IM开发者的零基础通信技术入门(十一)：为什么WiFi信号差？一文即懂！](http://www.52im.net/thread-2402-1-1.html)》
- 《[IM开发者的零基础通信技术入门(十二)：上网卡顿？网络掉线？一文即懂！](http://www.52im.net/thread-2406-1-1.html)》
- 《[IM开发者的零基础通信技术入门(十三)：为什么手机信号差？一文即懂！](http://www.52im.net/thread-2415-1-1.html)》
- 《[IM开发者的零基础通信技术入门(十四)：高铁上无线上网有多难？一文即懂！](http://www.52im.net/thread-2419-1-1.html)》
- 《[IM开发者的零基础通信技术入门(十五)：理解定位技术，一篇就够](http://www.52im.net/thread-2428-1-1.html)》



## 4、正文引言


移动互联网颠覆着我们的生活方式，这个每时每刻伴随着我们的网络到底有哪些特点，又是如何影响我们接入信息世界的体验呢。

**以下场景如似曾相识，敬请对号入座：**

1）上班路上收到朋友分享的一张美女图片，缩略图目测衣服用料相当节俭，立马兴奋点开欲详细钻研，却发现怎么脱也脱不下来，不对，是“拖”不是“脱”，仰望苍天，欲哭无泪。

2）进电梯前收到女友一条消息：“你到底爱不爱我！”，当然马上回复“必须的必！”，电梯门关闭了，北风那个吹，菊花那个转，等到春暖梯开，满屏都是女友的问候“在吗！”、“这都要想那么久！”、“跟哪个MM聊天呢！”、“我生气了！”、“你是好人，再见！”，看着自己的回复刚刚发送成功，停在最后一行，整个互动信息一气呵成，都是眼泪。

3）和朋友聚餐，菜端上先拍照分享，再大快朵颐，明明坐在对面，偏偏还得用手机聊天，世界最远的距离，莫过于我们坐在一起，却只能用手指切磋。

有因有果，有道有术，不入虎穴焉得虎子，不扯了，进入正题。

## 5、移动网络的特点


**理论上说，我们看到移动网络有如下三个典型特点：**



- 1）移动状态网络信号不稳定，高时延、易抖动丢包、通道狭窄；
- 2）移动状态网络接入类型和接入点变化频繁；
- 3）移动状态用户使用高频化、碎片化、非WIFI流量敏感。


为什么？

**参考【图一 无线网络链路示意】，我们尝试从物理上追根溯源：**

![移动端IM开发者必读(一)：通俗易懂，理解移动网络的“弱”和“慢”_1.jpg](%E7%A7%BB%E5%8A%A8%E7%AB%AFIM%E5%BC%80%E5%8F%91%E8%80%85%E5%BF%85%E8%AF%BB(%E4%B8%80)%EF%BC%9A%E9%80%9A%E4%BF%97%E6%98%93%E6%87%82%EF%BC%8C%E7%90%86%E8%A7%A3%E7%A7%BB%E5%8A%A8%E7%BD%91%E7%BB%9C%E7%9A%84%E2%80%9C%E5%BC%B1%E2%80%9D%E5%92%8C%E2%80%9C%E6%85%A2%E2%80%9D.assets/195343xa33g77nngt7atf1.jpg) 


▲ 图一：无线网络链路示意

根据“图一：无线网络链路示意”所示内容，我们可以得到以下信息。

**第一、直观印象是通讯链路长而复杂：**从（移动）终端设备到应用服务器之间，相较有线互联网，要多经过基站、核心网、WAP网关（好消息是WAP网关正在被依法取缔）等环节，这就像送快递，中间环节越多就越慢，每个中转站的服务质量和服务效率不一，每次传递都要重新交接入库和分派调度，一不小心还能把包裹给弄丢了。

**第二、这是个资源受限网络：**移动设备接入基站空中信道数量非常有限，信道调度更是相当复杂，如何复杂就不展开了，莫文蔚那首歌词用在这里正合适：“我讲又讲不清，你听又听不懂......”，最最重要的是分配的业务信道单元如果1秒钟不传数据就会立马被释放回收，六亲不认童叟无欺。

**第三、这个链条前端（无线端）是高时延（除某些WIFI场景外）、低带宽（除某些WIFI场景外）、易抖动的网络：**无线各种制式网络带宽上限都比较低而传输时延比较大（参见【表一 运营商移动信号制式带宽标准】），并且，没事就能丢个包裹玩玩，最最重要的是，距离基站的远近，把玩手机的角度、地下室的深度等等都能影响无线信号的质量，让包裹在空中飞一会，再飞一会......。这些因素也造成了移动互联网网络质量稳定性差、接入变化频繁，与有线互联网对比更是天上人间的差别，从【图二 有线互联网和移动互联网网络质量差异】中可以有更直观的感受。



![移动端IM开发者必读(一)：通俗易懂，理解移动网络的“弱”和“慢”_2.jpg](%E7%A7%BB%E5%8A%A8%E7%AB%AFIM%E5%BC%80%E5%8F%91%E8%80%85%E5%BF%85%E8%AF%BB(%E4%B8%80)%EF%BC%9A%E9%80%9A%E4%BF%97%E6%98%93%E6%87%82%EF%BC%8C%E7%90%86%E8%A7%A3%E7%A7%BB%E5%8A%A8%E7%BD%91%E7%BB%9C%E7%9A%84%E2%80%9C%E5%BC%B1%E2%80%9D%E5%92%8C%E2%80%9C%E6%85%A2%E2%80%9D.assets/195613cmgbblg9jjnbz4g4.jpg) 


▲ 图二：有线互联网和移动互联网网络质量差异

**【表一 运营商移动信号制式带宽标准】数据来自互联网各种百科，定性不定量，仅供参考；**

![移动端IM开发者必读(一)：通俗易懂，理解移动网络的“弱”和“慢”_未标题-1.gif](%E7%A7%BB%E5%8A%A8%E7%AB%AFIM%E5%BC%80%E5%8F%91%E8%80%85%E5%BF%85%E8%AF%BB(%E4%B8%80)%EF%BC%9A%E9%80%9A%E4%BF%97%E6%98%93%E6%87%82%EF%BC%8C%E7%90%86%E8%A7%A3%E7%A7%BB%E5%8A%A8%E7%BD%91%E7%BB%9C%E7%9A%84%E2%80%9C%E5%BC%B1%E2%80%9D%E5%92%8C%E2%80%9C%E6%85%A2%E2%80%9D.assets/201631qw7utbih57o99655.gif) 



![img](%E7%A7%BB%E5%8A%A8%E7%AB%AFIM%E5%BC%80%E5%8F%91%E8%80%85%E5%BF%85%E8%AF%BB(%E4%B8%80)%EF%BC%9A%E9%80%9A%E4%BF%97%E6%98%93%E6%87%82%EF%BC%8C%E7%90%86%E8%A7%A3%E7%A7%BB%E5%8A%A8%E7%BD%91%E7%BB%9C%E7%9A%84%E2%80%9C%E5%BC%B1%E2%80%9D%E5%92%8C%E2%80%9C%E6%85%A2%E2%80%9D.assets/rar.gif) [【表一-运营商移动信号制式带宽标准】-清晰图.rar](http://www.52im.net/forum.php?mod=attachment&aid=NDIyM3xmOWFjN2MwZnwxNjMwOTEyOTI3fDB8MTU4Nw%3D%3D) *(252.64 KB , 下载次数: 77 )* 



**第四、这是个局部封闭网络：**空中信道接入后要做鉴权、计费等预处理，WAP网络甚至还要做数据过滤后再转发，在业务数据有效流动前太多中间代理人求参与，效率可想而知。产品研发为什么又慢又乱，广大程序猿心里明镜似的；最最重要的是，不同运营商之间跨网传输既贵且慢又有诸多限制，聪明的运营商便也用上了缓存技术，催生了所谓网络“劫持”的现象。

如果我们再结合用户在移动状态下2G/3G/4G/WIFI的基站/AP之间，或者不同网络制式之间频繁的切换，情况就更加复杂了。

## 6、移动网络为什么“慢”


**我们在移动网络的特点介绍中，很容易的得到了三个关键字：**



- 1）“高时延”；
- 2）“易抖动”；
- 3）“通道窄”。


这些物理上的约束确实限制了我们移动冲浪时的速度体验，那么，还有别的因素吗。

**当然有，汗牛充栋、罄竹难书：**



- 1）DNS解析，这个在有线互联网上司空见惯的服务，在移动互联网上变成了一种负担，一个往复最少1s，还别提遇到移动运营商DNS故障时的尴尬；
- 2）链路建立成本暨TCP三次握手，在一个高时延易抖动的网络环境，并且大部分业务数据交互限于一个HTTP的往返，建链成本尤其显著；
- 3）TCP协议层慢启动、拥塞控制、超时重传等机制在移动网络下参数设定的不适宜；
- 4）不好的产品需求规定或粗放的技术方案实现，使得不受控的大数据包、频繁的数据网络交互等，在移动网络侧TCP链路上传输引起的负荷；
- 5）不好的协议格式和数据结构设计，使得协议封装和解析计算耗时、耗内存、耗带宽，甚至协议格式臃肿冗余，使得网络传输效能低下；
- 6）不好的缓存设计，使得数据的加载和渲染计算耗时、耗内存、耗带宽。


现在终于知道时间都去哪了，太浪费太奢侈，还让不让人愉快的玩手机了。天下武功，唯快不破，我们一起踏上“快”的探索之路吧。

**更多有关TCP的基础理论性文章，可以看看下面的文章：**



- 《[TCP/IP详解](http://www.52im.net/topic-tcpipvol1.html) - [第17章·TCP：传输控制协议](http://docs.52im.net/extend/docs/book/tcpip/vol1/17/)》
- 《[TCP/IP详解](http://www.52im.net/topic-tcpipvol1.html) - [第18章·TCP连接的建立与终止](http://docs.52im.net/extend/docs/book/tcpip/vol1/18/)》
- 《[TCP/IP详解](http://www.52im.net/topic-tcpipvol1.html) - [第21章·TCP的超时与重传](http://docs.52im.net/extend/docs/book/tcpip/vol1/21/)》
- 《[通俗易懂-深入理解TCP协议（上）：理论基础](http://www.52im.net/thread-513-1-1.html)》
- 《[通俗易懂-深入理解TCP协议（下）：RTT、滑动窗口、拥塞处理](http://www.52im.net/thread-515-1-1.html)》
- 《[理论经典：TCP协议的3次握手与4次挥手过程详解](http://www.52im.net/thread-258-1-1.html)》



## 7、针对移动网络“弱”和“慢”的特点，有优化办法吗？


答案是：有。

在移动互联网时代，对我们的产品和技术追求提出了更高的挑战，如何从容和优雅的面对，需要先从精神上做好充分的准备，用一套统一的思考和行动准则武装到牙齿。

从来就没有什么救世主，只有程序猿征服一切技术问题的梦想在空中飘荡。屡败屡战，把过往实践中的经验教训总结出来，共同研讨。针对移动网络的特点，我们总结一些实用方法，请看下篇《移动端IM开发者必读(二)：针对移动弱网络特性的优化方法总结》。